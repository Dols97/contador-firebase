<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Contador compartido</title>
</head>
<body>

<h1 id="contador">0</h1>
<button onclick="alert('click ok')">Obtener n√∫mero</button>

<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
  import { getFirestore, doc, runTransaction } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

	const firebaseConfig = {
	  apiKey: "AIzaSyC8b_vVtpAaCoqf7sopWIPD4Ubr9CdHnQc",
	  authDomain: "contador-2036b.firebaseapp.com",
	  projectId: "contador-2036b",
	  storageBucket: "contador-2036b.firebasestorage.app",
	  messagingSenderId: "306453517182",
	  appId: "1:306453517182:web:b02fa2edd7dc30b691192f",
	  measurementId: "G-15ZK3W7CLT"
	};

  const app = initializeApp(firebaseConfig);
  const db = getFirestore(app);

  async function obtenerNumero() {
    const ref = doc(db, "contador", "global");

    const nuevoNumero = await runTransaction(db, async (transaction) => {
      const snap = await transaction.get(ref);
      let valor = snap.exists() ? snap.data().valor : 0;
      valor++;
      transaction.set(ref, { valor });
      return valor;
    });

    document.getElementById("contador").textContent = nuevoNumero;
  }

  window.obtenerNumero = obtenerNumero;
</script>

</body>
</html>

