<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Contador compartido</title>
</head>
<body>

<h1 id="contador">—</h1>
<button id="btn">Obtener número</button>

<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
  import { getFirestore, doc, runTransaction } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

  const firebaseConfig = {
    apiKey: "AIzaSyC8b_vVtpAaCoqf7sopWIPD4Ubr9CdHnQc",
    authDomain: "contador-2036b.firebaseapp.com",
    projectId: "contador-2036b",
    storageBucket: "contador-2036b.firebasestorage.app",
    messagingSenderId: "306453517182",
    appId: "1:306453517182:web:b02fa2edd7dc30b691192f"
  };

  const app = initializeApp(firebaseConfig);
  const db = getFirestore(app);

  const contadorEl = document.getElementById("contador");

  function formatear(numero) {
    return String(numero).padStart(6, "0");
  }

  document.getElementById("btn").addEventListener("click", async () => {
    contadorEl.textContent = "…";

    try {
      const ref = doc(db, "contador", "global");

      const numeroAsignado = await runTransaction(db, async (tx) => {
        const snap = await tx.get(ref);
        let valor = 0;

        if (snap.exists() && typeof snap.data().valor === "number") {
          valor = snap.data().valor;
        }

        const siguiente = valor + 1;
        tx.set(ref, { valor: siguiente }, { merge: true });

        return siguiente;
      });

      contadorEl.textContent = formatear(numeroAsignado);
    } catch (e) {
      contadorEl.textContent = "N/A";
      console.error(e);
    }
  });
</script>

</body>
</html>

